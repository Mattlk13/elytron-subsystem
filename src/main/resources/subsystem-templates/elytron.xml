<?xml version='1.0' encoding='UTF-8'?>
<!--
  ~ JBoss, Home of Professional Open Source.
  ~ Copyright 2014 Red Hat, Inc., and individual contributors
  ~ as indicated by the @author tags.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<config default-supplement="standalone" >
    <extension-module>org.wildfly.extension.elytron</extension-module>
    <subsystem xmlns="urn:wildfly:elytron:1.0">
        <security-domains>
            <?DOMAIN_DEFINITIONS?>
        </security-domains>

        <security-realms>
            <?REALM_DEFINITIONS?>
        </security-realms>

        <http>
            <?HTTP_DEFINITIONS?>
            <provider-http-server-factory name="global"/>
        </http>

        <sasl>
            <?SASL_DEFINITIONS?>
            <provider-sasl-server-factory name="global"/>
        </sasl>
    </subsystem>

    <supplement name="domain">
        <replacement placeholder="DOMAIN_DEFINITIONS">
            <security-domain name="ApplicationDomain" default-realm="ApplicationRealm">
                <realm name="ApplicationRealm" />
            </security-domain>
        </replacement>
        <replacement placeholder="REALM_DEFINITIONS">
             <properties-realm name="ApplicationRealm">
                <users-properties path="application-users.properties" relative-to="jboss.domain.config.dir" />
                <groups-properties path="application-roles.properties" relative-to="jboss.domain.config.dir" />
            </properties-realm>
        </replacement>
        <replacement placeholder="HTTP_DEFINITIONS">
            <http-server-authentication name="application-http-authentication" http-server-factory="global" security-domain="ApplicationDomain"/>
        </replacement>
        <replacement placeholder="SASL_DEFINITIONS">
            <sasl-server-authentication name="application-sasl-authentication" sasl-server-factory="global" security-domain="ApplicationDomain"/>
        </replacement>
    </supplement>

    <supplement name="host">
        <replacement placeholder="DOMAIN_DEFINITIONS">
            <security-domain name="ManagementDomain" default-realm="ManagementRealm">
                <realm name="ManagementRealm" />
            </security-domain>
        </replacement>
        <replacement placeholder="REALM_DEFINITIONS">
            <properties-realm name="ManagementRealm">
                <users-properties path="mgmt-users.properties" relative-to="jboss.domain.config.dir" />
                <groups-properties path="mgmt-groups.properties" relative-to="jboss.domain.config.dir" />
            </properties-realm>
        </replacement>
        <replacement placeholder="HTTP_DEFINITIONS">
            <http-server-authentication name="management-http-authentication" http-server-factory="global" security-domain="ManagementDomain"/>
        </replacement>
        <replacement placeholder="SASL_DEFINITIONS">
            <sasl-server-authentication name="management-sasl-authentication" sasl-server-factory="global" security-domain="ManagementDomain"/>
        </replacement>
    </supplement>

    <supplement name="standalone">
        <replacement placeholder="DOMAIN_DEFINITIONS">
            <security-domain name="ApplicationDomain" default-realm="ApplicationRealm">
                <realm name="ApplicationRealm" />
            </security-domain>

            <security-domain name="ManagementDomain" default-realm="ManagementRealm">
                <realm name="ManagementRealm" />
            </security-domain>
        </replacement>
        <replacement placeholder="REALM_DEFINITIONS">
             <properties-realm name="ApplicationRealm">
                <users-properties path="application-users.properties" relative-to="jboss.server.config.dir" />
                <groups-properties path="application-roles.properties" relative-to="jboss.server.config.dir" />
            </properties-realm>

            <properties-realm name="ManagementRealm">
                <users-properties path="mgmt-users.properties" relative-to="jboss.server.config.dir" />
                <groups-properties path="mgmt-groups.properties" relative-to="jboss.server.config.dir" />
            </properties-realm>
        </replacement>
        <replacement placeholder="HTTP_DEFINITIONS">
            <http-server-authentication name="management-http-authentication" http-server-factory="global" security-domain="ManagementDomain"/>
            <http-server-authentication name="application-http-authentication" http-server-factory="global" security-domain="ApplicationDomain"/>
        </replacement>
        <replacement placeholder="SASL_DEFINITIONS">
            <sasl-server-authentication name="management-sasl-authentication" sasl-server-factory="global" security-domain="ManagementDomain"/>
            <sasl-server-authentication name="application-sasl-authentication" sasl-server-factory="global" security-domain="ApplicationDomain"/>
        </replacement>
    </supplement>
</config>

